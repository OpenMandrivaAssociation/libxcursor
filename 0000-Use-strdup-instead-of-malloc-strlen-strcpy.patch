From bbf3c582c97af3abfaf81e3ca63646d59fe6e28a Mon Sep 17 00:00:00 2001
From: Alan Coopersmith <alan.coopersmith@oracle.com>
Date: Sat, 18 Oct 2014 10:24:13 -0700
Subject: [PATCH 0/2] Use strdup() instead of malloc(strlen())+strcpy()

Signed-off-by: Alan Coopersmith <alan.coopersmith@oracle.com>
---
 configure.ac  |  4 ++++
 src/display.c | 16 +++-------------
 src/file.c    |  3 +--
 3 files changed, 8 insertions(+), 15 deletions(-)

diff --git a/configure.ac b/configure.ac
index 4768f88..20c566c 100644
--- a/configure.ac
+++ b/configure.ac
@@ -30,6 +30,10 @@ AC_INIT([libXcursor], [1.1.14],
         [https://bugs.freedesktop.org/enter_bug.cgi?product=xorg],[libXcursor])
 AC_CONFIG_SRCDIR([Makefile.am])
 AC_CONFIG_HEADERS([config.h include/X11/Xcursor/Xcursor.h])
+# Set common system defines for POSIX extensions, such as _GNU_SOURCE
+# Must be called before any macros that run the compiler (like AC_PROG_LIBTOOL)
+# to avoid autoconf errors.
+AC_USE_SYSTEM_EXTENSIONS
 
 # Initialize Automake
 AM_INIT_AUTOMAKE([foreign dist-bzip2])
diff --git a/src/display.c b/src/display.c
index 7998fe7..77dd325 100644
--- a/src/display.c
+++ b/src/display.c
@@ -216,17 +216,8 @@ _XcursorGetDisplayInfo (Display *dpy)
 	v = XGetDefault (dpy, "Xcursor", "theme");
     if (v)
     {
-	int len;
-
-	len = strlen (v) + 1;
-
-	info->theme = malloc (len);
-	if (info->theme)
-	    strcpy (info->theme, v);
-
-	info->theme_from_config = malloc (len);
-	if (info->theme_from_config)
-	    strcpy (info->theme_from_config, v);
+	info->theme = strdup (v);
+	info->theme_from_config = strdup (v);
     }
 
     /*
@@ -342,10 +333,9 @@ XcursorSetTheme (Display *dpy, const char *theme)
 
     if (theme)
     {
-	copy = malloc (strlen (theme) + 1);
+	copy = strdup (theme);
 	if (!copy)
 	    return XcursorFalse;
-	strcpy (copy, theme);
     }
     else
 	copy = NULL;
diff --git a/src/file.c b/src/file.c
index ce9de78..43163c2 100644
--- a/src/file.c
+++ b/src/file.c
@@ -86,12 +86,11 @@ XcursorImagesSetName (XcursorImages *images, const char *name)
     if (!images || !name)
         return;
 
-    new = malloc (strlen (name) + 1);
+    new = strdup (name);
 
     if (!new)
 	return;
 
-    strcpy (new, name);
     if (images->name)
 	free (images->name);
     images->name = new;
-- 
2.8.3

